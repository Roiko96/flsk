<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Game Scoreboard</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 2rem; }
    header { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
    table { width:100%; border-collapse:collapse; margin-top:1rem; }
    th, td { border:1px solid #ddd; padding:.5rem .6rem; text-align:center; }
    th a { text-decoration:none; }
    form { display:grid; gap:.5rem; grid-template-columns: repeat(6, 1fr); margin-top:1rem; }
    form input, button { padding:.45rem; }
    .muted { color:#666; font-size:.9rem; }
    .bar { display:flex; gap:.5rem; align-items:center; flex-wrap:wrap; }
    .card { border:1px solid #eee; padding:1rem; border-radius:.5rem; }
  </style>
  <script>
    // מניעת קאש קדמי
    window.addEventListener('pageshow', function(e){ if(e.persisted) location.reload(); });
    // פינג קטן כל 60ש' (לא חובה)
    setInterval(()=>{ fetch('/healthz').catch(()=>{}); }, 60000);
  </script>
</head>
<body>
<header>
  <h1>Game Scoreboard</h1>
  <div class="muted">Host: {{ host }}</div>
</header>

<div class="bar">
  <a href="/sort/name" class="card">מיין לפי שם</a>
  <a href="/sort/game" class="card">מיין לפי משחק</a>
  <a href="/sort/score" class="card">מיין לפי ציון (יורד)</a>
  <a href="/average" class="card">ממוצע</a>
  <a href="/" class="card">רענון</a>
</div>

{% if average is defined %}
  <p><strong>ממוצע ציונים:</strong> {{ average }}</p>
{% endif %}

<table>
  <thead>
    <tr><th>שם</th><th>משחק</th><th>ציון</th></tr>
  </thead>
  <tbody>
  {% for s in scores %}
    <tr>
      <td>{{ s.name }}</td>
      <td>{{ s.game }}</td>
      <td>{{ s.score }}</td>
    </tr>
  {% endfor %}
  {% if not scores %}
    <tr><td colspan="3" class="muted">אין נתונים עדיין</td></tr>
  {% endif %}
  </tbody>
</table>

<h3>הוספה</h3>
<form action="/add" method="post">
  <input name="name" placeholder="שם" required>
  <input name="game" placeholder="משחק" required>
  <input name="score" placeholder="ציון (למשל 98 או 98,5)" required>
  <button type="submit">הוסף</button>
</form>

<h3>מחיקה לפי שם</h3>
<form action="/delete" method="post">
  <input name="name" placeholder="שם למחיקה" required>
  <button type="submit">מחק</button>
</form>

<h3>עריכה</h3>
<form action="/edit" method="post">
  <input name="current_name" placeholder="שם נוכחי" required>
  <input name="current_game" placeholder="משחק נוכחי" required>
  <input name="new_name" placeholder="שם חדש" required>
  <input name="new_game" placeholder="משחק חדש" required>
  <input name="new_score" placeholder="ציון חדש" required>
  <button type="submit">עדכן</button>
</form>

<p class="muted">דמו ללא מסד נתונים; ב‑Scaling הנתונים נשמרים פר‑אינסטנס.</p>
</body>
</html>
